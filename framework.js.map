{"version":3,"sources":["framework.js","framework.ts"],"names":[],"mappings":"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","file":"framework.js","sourcesContent":["\"use strict\";\nconst express = require('express');\nconst bodyParser = require('body-parser');\nconst webdriver = require('selenium-webdriver');\nconst crypto = require('crypto');\nconst fs = require('fs');\nconst path = require('path');\nprocess.on('uncaughtException', ex => {\n    console.log(\"Runtime Error\");\n    console.log(\"TestFramework exception:\", ex);\n    process.exit();\n});\nclass FrontEndTestFramework {\n    constructor() {\n        this.d = new webdriver.Builder()\n            .forBrowser('firefox')\n            .build();\n        this.e = express();\n        this.currentProgress = 0;\n        this.testSuite = {\n            inputHTMLs: [],\n            correctOutputHTMLs: [],\n            length: 0\n        };\n        if (!fs.existsSync(process.argv[2])) {\n            console.log(\"Runtime Error\");\n            console.log(\"You may want to append <path/to/user/script.js> as an argument.\");\n            process.exit();\n        }\n        this.e.get(\"/\", (req, res, next) => {\n            res.type(\"html\").end(this.testSuite.inputHTMLs[this.currentProgress]);\n        });\n        this.e.use(bodyParser.urlencoded({ extended: false }));\n    }\n    startServer({ staticRoot = \"./static/\", portMaxTrial = 10 } = {}) {\n        let trialLeft = portMaxTrial;\n        let probe = cb => {\n            if (--trialLeft == 0)\n                throw \"Unable to find a free port for server\";\n            this.port = Math.round(Math.random() * 8192 + 8192);\n            this.e.listen(this.port, 'localhost', cb.bind(this))\n                .on('error', () => probe(cb));\n        };\n        this.e.use(express.static(staticRoot));\n        return new Promise(probe);\n    }\n    set inputHTML(html) {\n        this.testSuite.inputHTMLs = [html];\n        this.testSuite.length = 1;\n    }\n    set correctOutputHTML(html) {\n        this.testSuite.correctOutputHTMLs = [html];\n        this.testSuite.length = 1;\n    }\n    eachIteration(documentReady) {\n        if (documentReady instanceof Function)\n            this.fnIteration = documentReady;\n    }\n    waitWithTimeout(cond) {\n        return this.d.wait(cond, 2000).thenCatch(ex => {\n            console.log(\"Time Limit Exceeded\");\n            console.log(this.currentProgress + \"/\" + this.testSuite.length);\n            process.exit();\n        });\n    }\n    runUserScript() {\n        return this.d.executeScript(readScript()).thenCatch(ex => {\n            console.log(\"Runtime Error\");\n            console.log(\"User script exception:\", ex);\n            process.exit();\n        });\n    }\n    runTest() {\n        for (var i = 0; i < this.testSuite.length; i++) {\n            this.d.get(this.homeURL);\n            this.d.call(this.fnIteration.bind(this, i));\n            this.d.executeScript(function (answer) {\n                // 在浏览器上执行的判断脚本\n                var doc = document.implementation.createHTMLDocument(\"\");\n                doc.documentElement.innerHTML = answer;\n                function nodeEqual(node1, node2) {\n                    if (node1.tagName != node2.tagName)\n                        return false;\n                    var attr1 = node1.attributes, attr2 = node2.attributes;\n                    for (var i = 0; i < attr1.length; i++)\n                        if (attr1[i].specified) {\n                            var that = attr2.getNamedItem(attr1[i].name);\n                            if (!that || that.value != attr1[i].value)\n                                return false;\n                        }\n                    for (var i = 0; i < attr2.length; i++)\n                        if (attr2[i].specified) {\n                            var that = attr1.getNamedItem(attr2[i].name);\n                            if (!that || that.value != attr2[i].value)\n                                return false;\n                        }\n                    if (!node1.children || !node2.children ||\n                        node1.children.length != node2.children.length)\n                        return false;\n                    if (node1.children.length == 0) {\n                        if (node1.textContent.trim() != node2.textContent.trim())\n                            return false;\n                    }\n                    else\n                        for (var i = 0; i < node1.children.length; i++)\n                            if (!nodeEqual(node1.children[i], node2.children[i]))\n                                return false;\n                    return true;\n                }\n                return nodeEqual(doc.body, document.body);\n            }, this.testSuite.correctOutputHTMLs[i]).then(result => {\n                if (!result) {\n                    console.log('Wrong Answer');\n                    console.log(this.currentProgress + \"/\" + this.testSuite.length);\n                    process.exit();\n                }\n                this.currentProgress++;\n            }).thenCatch(ex => {\n                console.log(\"Runtime Error\");\n                console.log(\"Evaluation script exception:\", ex);\n                process.exit();\n            });\n        }\n        this.d.quit().then(() => {\n            console.log(\"Accepted\");\n            process.exit();\n        });\n    }\n    get homeURL() {\n        return `http://localhost:${this.port}/`;\n    }\n}\nexports.FrontEndTestFramework = FrontEndTestFramework;\n;\nfunction md5(str) {\n    let h = crypto.createHash('md5');\n    h.update(str);\n    return h.digest('hex');\n}\nexports.md5 = md5;\n;\nfunction randStr() {\n    return md5((Date.now() + Math.random()).toString());\n}\nexports.randStr = randStr;\n;\nfunction readScript() {\n    return fs.readFileSync(path.join(__dirname, process.argv[2])).toString();\n}\nexports.readScript = readScript;\n;\nfunction readTestSuite(count) {\n    let prefix = path.join(__dirname, path.basename(process.argv[1], \".js\"));\n    let suite = {\n        inputHTMLs: [],\n        correctOutputHTMLs: [],\n        length: count\n    };\n    try {\n        for (var i = 0; i < count; i++) {\n            suite.inputHTMLs[i] = fs.readFileSync(`${prefix}.in.${i}.html`).toString();\n            suite.correctOutputHTMLs[i] = fs.readFileSync(`${prefix}.out.${i}.html`).toString();\n        }\n    }\n    catch (ex) {\n        console.log(\"Runtime Error\");\n        console.log(\"Bad test suite\");\n        process.exit();\n    }\n    return suite;\n}\nexports.readTestSuite = readTestSuite;\n;\nexports.By = webdriver.By;\nexports.until = webdriver.until;\n","import express = require('express');\r\nimport bodyParser = require('body-parser');\r\nimport webdriver = require('selenium-webdriver');\r\nimport crypto = require('crypto');\r\nimport fs = require('fs');\r\nimport path = require('path');\r\n\r\ninterface ITestSuite {\r\n\tinputHTMLs: string[];\r\n\tcorrectOutputHTMLs: string[];\r\n\tlength: number;\r\n}\r\n\r\nprocess.on('uncaughtException', ex => {\r\n\tconsole.log(\"Runtime Error\");\r\n\tconsole.log(\"TestFramework exception:\", ex);\r\n\tprocess.exit();\r\n})\r\n\r\nexport class FrontEndTestFramework {\r\n\tpublic d = new webdriver.Builder()\r\n\t\t.forBrowser('firefox')\r\n\t\t.build();\r\n\tpublic e: express.Express = express();\r\n\t\r\n\tpublic currentProgress: number = 0;\r\n\tpublic testSuite: ITestSuite = {\r\n\t\tinputHTMLs: [],\r\n\t\tcorrectOutputHTMLs: [],\r\n\t\tlength: 0\r\n\t};\r\n\r\n\tprivate port: number;\r\n\tprivate fnIteration: (iteration: number) => void;\r\n\t\r\n\tpublic constructor() {\r\n\t\tif (!fs.existsSync(process.argv[2])) {\r\n\t\t\tconsole.log(\"Runtime Error\");\r\n\t\t\tconsole.log(\"You may want to append <path/to/user/script.js> as an argument.\");\r\n\t\t\tprocess.exit();\r\n\t\t}\r\n\t\tthis.e.get(\"/\", (req, res, next) => {\r\n\t\t\tres.type(\"html\").end(this.testSuite.inputHTMLs[this.currentProgress]);\r\n\t\t});\r\n\t\tthis.e.use(bodyParser.urlencoded({ extended: false }));\r\n\t}\r\n\r\n\tpublic startServer({ \r\n\t\tstaticRoot = \"./static/\",\r\n\t\tportMaxTrial = 10\r\n\t} = {}) {\r\n\t\tlet trialLeft = portMaxTrial;\r\n\t\tlet probe = cb => {\r\n\t\t\tif (--trialLeft == 0)\r\n\t\t\t\tthrow \"Unable to find a free port for server\";\r\n\t\t\tthis.port = Math.round(Math.random() * 8192 + 8192);\r\n\t\t\tthis.e.listen(this.port, 'localhost', cb.bind(this))\r\n\t\t\t\t.on('error', () => probe(cb));\r\n\t\t}\r\n\t\tthis.e.use(express.static(staticRoot));\r\n\t\treturn new Promise<void>(probe);\r\n\t}\r\n\t\r\n\tpublic set inputHTML(html: string) {\r\n\t\tthis.testSuite.inputHTMLs = [html];\r\n\t\tthis.testSuite.length = 1;\r\n\t}\r\n\tpublic set correctOutputHTML(html: string) {\r\n\t\tthis.testSuite.correctOutputHTMLs = [html];\r\n\t\tthis.testSuite.length = 1;\r\n\t}\r\n\t\r\n\tpublic eachIteration(documentReady: (iteration: number) => void) {\r\n\t\tif (documentReady instanceof Function)\r\n\t\t\tthis.fnIteration = documentReady;\r\n\t}\r\n\t\r\n\tpublic waitWithTimeout(cond: webdriver.until.Condition<webdriver.WebElement>) {\r\n\t\treturn this.d.wait(cond, 2000).thenCatch(ex => {\r\n\t\t\tconsole.log(\"Time Limit Exceeded\");\r\n\t\t\tconsole.log(this.currentProgress + \"/\" + this.testSuite.length);\r\n\t\t\tprocess.exit();\r\n\t\t});\r\n\t}\r\n\t\r\n\tpublic runUserScript() {\r\n\t\treturn this.d.executeScript(readScript()).thenCatch(ex => {\r\n\t\t\tconsole.log(\"Runtime Error\");\r\n\t\t\tconsole.log(\"User script exception:\", ex);\r\n\t\t\tprocess.exit();\r\n\t\t});\r\n\t}\r\n\t\r\n\tpublic runTest() {\r\n\t\tfor (var i = 0; i < this.testSuite.length; i++) {\r\n\t\t\tthis.d.get(this.homeURL);\r\n\t\t\tthis.d.call(this.fnIteration.bind(this, i));\r\n\t\t\tthis.d.executeScript<boolean>(function (answer) {\r\n\t\t\t\t// 在浏览器上执行的判断脚本\r\n\t\t\t\tvar doc = document.implementation.createHTMLDocument(\"\");\r\n\t\t\t\tdoc.documentElement.innerHTML = answer;\r\n\t\t\t\t\r\n\t\t\t\tfunction nodeEqual(node1, node2) {\r\n\t\t\t\t\tif (node1.tagName != node2.tagName)\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\tvar attr1 = node1.attributes, attr2 = node2.attributes;\r\n\t\t\t\t\tfor (var i = 0; i < attr1.length; i++)\r\n\t\t\t\t\t\tif (attr1[i].specified) {\r\n\t\t\t\t\t\t\tvar that = attr2.getNamedItem(attr1[i].name);\r\n\t\t\t\t\t\t\tif (!that || that.value != attr1[i].value)\r\n\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\tfor (var i = 0; i < attr2.length; i++)\r\n\t\t\t\t\t\tif (attr2[i].specified) {\r\n\t\t\t\t\t\t\tvar that = attr1.getNamedItem(attr2[i].name);\r\n\t\t\t\t\t\t\tif (!that || that.value != attr2[i].value)\r\n\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\tif (!node1.children || !node2.children ||\r\n\t\t\t\t\t\tnode1.children.length != node2.children.length)\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\tif (node1.children.length == 0) {\r\n\t\t\t\t\t\tif (node1.textContent.trim() != node2.textContent.trim())\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t} else\r\n\t\t\t\t\t\tfor (var i = 0; i < node1.children.length; i++)\r\n\t\t\t\t\t\t\tif (!nodeEqual(node1.children[i], node2.children[i]))\r\n\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\treturn nodeEqual(doc.body, document.body);\r\n\t\t\t}, this.testSuite.correctOutputHTMLs[i]).then(result => {\r\n\t\t\t\tif (!result) {\r\n\t\t\t\t\tconsole.log('Wrong Answer');\r\n\t\t\t\t\tconsole.log(this.currentProgress + \"/\" + this.testSuite.length);\r\n\t\t\t\t\tprocess.exit();\r\n\t\t\t\t}\r\n\t\t\t\tthis.currentProgress++;\r\n\t\t\t}).thenCatch(ex => {\r\n\t\t\t\tconsole.log(\"Runtime Error\");\r\n\t\t\t\tconsole.log(\"Evaluation script exception:\", ex);\r\n\t\t\t\tprocess.exit();\r\n\t\t\t});\r\n\t\t}\r\n\t\tthis.d.quit().then(() => {\r\n\t\t\tconsole.log(\"Accepted\");\r\n\t\t\tprocess.exit();\r\n\t\t})\r\n\t}\r\n\r\n\tpublic get homeURL() {\r\n\t\treturn `http://localhost:${this.port}/`;\r\n\t}\r\n};\r\n\r\nexport function md5(str: string) {\r\n\tlet h = crypto.createHash('md5');\r\n\th.update(str);\r\n\treturn h.digest('hex');\r\n};\r\nexport function randStr() {\r\n\treturn md5((Date.now() + Math.random()).toString());\r\n};\r\nexport function readScript() {\r\n\treturn fs.readFileSync(path.join(__dirname, process.argv[2])).toString();\r\n};\r\nexport function readTestSuite(count: number) {\r\n\tlet prefix = path.join(__dirname, path.basename(process.argv[1], \".js\"));\r\n\tlet suite: ITestSuite = {\r\n\t\tinputHTMLs: [],\r\n\t\tcorrectOutputHTMLs: [],\r\n\t\tlength: count\r\n\t};\r\n\ttry {\r\n\t\tfor (var i = 0; i < count; i++) {\r\n\t\t\tsuite.inputHTMLs[i] = fs.readFileSync(`${prefix}.in.${i}.html`).toString();\r\n\t\t\tsuite.correctOutputHTMLs[i] = fs.readFileSync(`${prefix}.out.${i}.html`).toString();\r\n\t\t}\r\n\t} catch (ex) {\r\n\t\tconsole.log(\"Runtime Error\");\r\n\t\tconsole.log(\"Bad test suite\");\r\n\t\tprocess.exit();\r\n\t}\r\n\treturn suite;\r\n};\r\nexport var By = webdriver.By;\r\nexport var until = webdriver.until;"],"sourceRoot":"/source/"}