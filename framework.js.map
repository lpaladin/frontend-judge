{"version":3,"sources":["framework.js","framework.ts"],"names":[],"mappings":"AAAA;;ACAA,MAAO,UAAO,QAAW,SAAX,CAAP;AACP,MAAO,aAAU,QAAW,aAAX,CAAV;AACP,MAAO,YAAS,QAAW,oBAAX,CAAT;AACP,MAAO,SAAM,QAAW,QAAX,CAAN;AACP,MAAO,KAAE,QAAW,IAAX,CAAF;AACP,MAAO,OAAI,QAAW,MAAX,CAAJ;AAEP,MAAA,qBAAA,CAAA;AAWC,kBAAA;AAVO,aAAA,CAAA,GAAI,IAAI,UAAU,OAAV,EAAJ,CACT,UADS,CACE,SADF,EAET,KAFS,EAAJ,CAUP;AAPO,aAAA,CAAA,GAAqB,SAArB,CAOP;AACC,YAAI,CAAC,GAAG,UAAH,CAAc,QAAQ,IAAR,CAAa,CAAb,CAAd,CAAD,EAAiC;AACpC,oBAAQ,GAAR,CAAY,eAAZ,EADoC;AAEpC,oBAAQ,GAAR,CAAY,iEAAZ,EAFoC;AAGpC,oBAAQ,IAAR,GAHoC;SAArC;AAKA,aAAK,CAAL,CAAO,GAAP,CAAW,GAAX,EAAgB,CAAC,GAAD,EAAM,GAAN,EAAW,IAAX,KAAe;AAC9B,gBAAI,IAAJ,CAAS,MAAT,EAAiB,GAAjB,CAAqB,KAAK,SAAL,CAArB,CAD8B;SAAf,CAAhB,CAND;AASC,aAAK,CAAL,CAAO,GAAP,CAAW,WAAW,UAAX,CAAsB,EAAE,UAAU,KAAV,EAAxB,CAAX,EATD;KAAA;AAYO,kBAGD;yEAAF,kBAAE;;mCAFL,WAEK;YAFL,6CAAa,8BAER;qCADL,aACK;YADL,iDAAe,uBACV;;AAEL,YAAI,YAAY,YAAZ,CAFC;AAGL,YAAI,QAAQ,MAAE;AACb,gBAAI,EAAE,SAAF,IAAe,CAAf,EACH,MAAM,uCAAN,CADD;AAEA,iBAAK,IAAL,GAAY,KAAK,KAAL,CAAW,KAAK,MAAL,KAAgB,IAAhB,GAAuB,IAAvB,CAAvB,CAHa;AAIb,iBAAK,CAAL,CAAO,MAAP,CAAc,KAAK,IAAL,EAAW,WAAzB,EAAsC,MAAA;AACrC,qBAAK,CAAL,CAAO,GAAP,CAAW,KAAK,OAAL,CAAX,CADqC;AAErC,mBAAG,KAAH,CAAS,IAAT,EAFqC;aAAA,CAAtC,CAGG,EAHH,CAGM,OAHN,EAGe,MAAM,MAAM,EAAN,CAAN,CAHf,CAJa;SAAF,CAHP;AAYL,aAAK,CAAL,CAAO,GAAP,CAAW,QAAQ,MAAR,CAAe,UAAf,CAAX,EAZK;AAaL,eAAO,IAAI,OAAJ,CAAkB,KAAlB,CAAP,CAbK;KAHC;AAmBA,oBAAgB,IAAhB,EAAqE;AAC3E,eAAO,KAAK,CAAL,CAAO,IAAP,CAAY,IAAZ,EAAkB,IAAlB,EAAwB,SAAxB,CAAkC,MAAA;AACxC,oBAAQ,GAAR,CAAY,qBAAZ,EADwC;AAExC,oBAAQ,IAAR,GAFwC;SAAA,CAAzC,CAD2E;KAArE;AAOA,oBAAa;AACnB,aAAK,CAAL,CAAO,aAAP,CAAqB,YAArB,EAAmC,SAAnC,CAA6C,MAAA;AAC5C,oBAAQ,GAAR,CAAY,eAAZ,EAD4C;AAE5C,oBAAQ,IAAR,GAF4C;SAAA,CAA7C,CADmB;KAAb;AAOA,yBAAkB;AACxB,aAAK,CAAL,CAAO,aAAP,CAA8B,UAAU,MAAV,EAAgB;;AAE7C,gBAAI,MAAM,SAAS,cAAT,CAAwB,kBAAxB,CAA2C,EAA3C,CAAN,CAFyC;AAG7C,gBAAI,eAAJ,CAAoB,SAApB,GAAgC,MAAhC,CAH6C;AAK7C,qBAAA,SAAA,CAAmB,KAAnB,EAA0B,KAA1B,EAA+B;AAC9B,oBAAI,MAAM,OAAN,IAAiB,MAAM,OAAN,EACpB,OAAO,KAAP,CADD;AAGA,oBAAI,QAAQ,MAAM,UAAN;oBAAkB,QAAQ,MAAM,UAAN,CAJR;AAK9B,qBAAK,IAAI,IAAI,CAAJ,EAAO,IAAI,MAAM,MAAN,EAAc,GAAlC,EACC,IAAI,MAAM,CAAN,EAAS,SAAT,EAAoB;AACvB,wBAAI,OAAO,MAAM,YAAN,CAAmB,MAAM,CAAN,EAAS,IAAT,CAA1B,CADmB;AAEvB,wBAAI,CAAC,IAAD,IAAS,KAAK,KAAL,IAAc,MAAM,CAAN,EAAS,KAAT,EAC1B,OAAO,KAAP,CADD;iBAFD;AAKD,qBAAK,IAAI,IAAI,CAAJ,EAAO,IAAI,MAAM,MAAN,EAAc,GAAlC,EACC,IAAI,MAAM,CAAN,EAAS,SAAT,EAAoB;AACvB,wBAAI,OAAO,MAAM,YAAN,CAAmB,MAAM,CAAN,EAAS,IAAT,CAA1B,CADmB;AAEvB,wBAAI,CAAC,IAAD,IAAS,KAAK,KAAL,IAAc,MAAM,CAAN,EAAS,KAAT,EAC1B,OAAO,KAAP,CADD;iBAFD;AAMD,oBAAI,CAAC,MAAM,QAAN,IAAkB,CAAC,MAAM,QAAN,IACvB,MAAM,QAAN,CAAe,MAAf,IAAyB,MAAM,QAAN,CAAe,MAAf,EACzB,OAAO,KAAP,CAFD;AAIA,oBAAI,MAAM,QAAN,CAAe,MAAf,IAAyB,CAAzB,EAA4B;AAC/B,wBAAI,MAAM,WAAN,IAAqB,MAAM,WAAN,EACxB,OAAO,KAAP,CADD;iBADD,MAIC,KAAK,IAAI,IAAI,CAAJ,EAAO,IAAI,MAAM,QAAN,CAAe,MAAf,EAAuB,GAA3C,EACC,IAAI,CAAC,UAAU,MAAM,QAAN,CAAe,CAAf,CAAV,EAA6B,MAAM,QAAN,CAAe,CAAf,CAA7B,CAAD,EACH,OAAO,KAAP,CADD;AAGF,uBAAO,IAAP,CA9B8B;aAA/B;AAiCA,mBAAO,UAAU,IAAI,IAAJ,EAAU,SAAS,IAAT,CAA3B,CAtC6C;SAAhB,EAuC3B,KAAK,iBAAL,CAvCH,CAuC2B,IAvC3B,CAuCgC,UAAM;AACrC,gBAAI,MAAJ,EACC,QAAQ,GAAR,CAAY,UAAZ,EADD,KAGC,QAAQ,GAAR,CAAY,cAAZ,EAHD;SAD+B,CAvChC,CADwB;AA8CxB,aAAK,CAAL,CAAO,IAAP,GAAc,IAAd,CAAmB,MAAM,QAAQ,IAAR,EAAN,CAAnB,CA9CwB;KAAlB;AAiDP,QAAW,OAAX,GAAkB;AACjB,eAAO,CAAA,iBAAA,GAAoB,KAAK,IAAL,EAAS,CAA7B,CAAP,CADiB;KAAlB;CAzGD;AAAa,QAAA,qBAAA,GAAqB,qBAArB;AA4GZ;AAED,SAAA,GAAA,CAAoB,GAApB,EAA+B;AAC9B,QAAI,IAAI,OAAO,UAAP,CAAkB,KAAlB,CAAJ,CAD0B;AAE9B,MAAE,MAAF,CAAS,GAAT,EAF8B;AAG9B,WAAO,EAAE,MAAF,CAAS,KAAT,CAAP,CAH8B;CAA/B;AAAgB,QAAA,GAAA,GAAG,GAAH;AAIf;AACD,SAAA,OAAA,GAAA;AACC,WAAO,IAAI,CAAC,KAAK,GAAL,KAAa,KAAK,MAAL,EAAb,CAAD,CAA6B,QAA7B,EAAJ,CAAP,CADD;CAAA;AAAgB,QAAA,OAAA,GAAO,OAAP;AAEf;AACD,SAAA,UAAA,GAAA;AACC,WAAO,GAAG,YAAH,CAAgB,KAAK,IAAL,CAAU,SAAV,EAAqB,QAAQ,IAAR,CAAa,CAAb,CAArB,CAAhB,EAAuD,QAAvD,EAAP,CADD;CAAA;AAAgB,QAAA,UAAA,GAAU,UAAV;AAEf;AACU,QAAA,EAAA,GAAK,UAAU,EAAV;AACL,QAAA,KAAA,GAAQ,UAAU,KAAV","file":"framework.js","sourcesContent":["\"use strict\";\nconst express = require('express');\nconst bodyParser = require('body-parser');\nconst webdriver = require('selenium-webdriver');\nconst crypto = require('crypto');\nconst fs = require('fs');\nconst path = require('path');\nclass FrontEndTestFramework {\n    constructor() {\n        this.d = new webdriver.Builder()\n            .forBrowser('firefox')\n            .build();\n        this.e = express();\n        if (!fs.existsSync(process.argv[2])) {\n            console.log(\"Runtime Error\");\n            console.log(\"You may want to append <path/to/user/script.js> as an argument.\");\n            process.exit();\n        }\n        this.e.get(\"/\", (req, res, next) => {\n            res.type(\"html\").end(this.inputHTML);\n        });\n        this.e.use(bodyParser.urlencoded({ extended: false }));\n    }\n    startServer({ staticRoot = \"./static/\", portMaxTrial = 10 } = {}) {\n        let trialLeft = portMaxTrial;\n        let probe = cb => {\n            if (--trialLeft == 0)\n                throw \"Unable to find a free port for server\";\n            this.port = Math.round(Math.random() * 8192 + 8192);\n            this.e.listen(this.port, 'localhost', () => {\n                this.d.get(this.homeURL);\n                cb.apply(this);\n            }).on('error', () => probe(cb));\n        };\n        this.e.use(express.static(staticRoot));\n        return new Promise(probe);\n    }\n    waitWithTimeout(cond) {\n        return this.d.wait(cond, 2000).thenCatch(() => {\n            console.log(\"Time Limit Exceeded\");\n            process.exit();\n        });\n    }\n    runUserScript() {\n        this.d.executeScript(readScript()).thenCatch(() => {\n            console.log(\"Runtime Error\");\n            process.exit();\n        });\n    }\n    testEqualityAndEnd() {\n        this.d.executeScript(function (answer) {\n            // 在浏览器上执行的判断脚本\n            var doc = document.implementation.createHTMLDocument(\"\");\n            doc.documentElement.innerHTML = answer;\n            function nodeEqual(node1, node2) {\n                if (node1.tagName != node2.tagName)\n                    return false;\n                var attr1 = node1.attributes, attr2 = node2.attributes;\n                for (var i = 0; i < attr1.length; i++)\n                    if (attr1[i].specified) {\n                        var that = attr2.getNamedItem(attr1[i].name);\n                        if (!that || that.value != attr1[i].value)\n                            return false;\n                    }\n                for (var i = 0; i < attr2.length; i++)\n                    if (attr2[i].specified) {\n                        var that = attr1.getNamedItem(attr2[i].name);\n                        if (!that || that.value != attr2[i].value)\n                            return false;\n                    }\n                if (!node1.children || !node2.children ||\n                    node1.children.length != node2.children.length)\n                    return false;\n                if (node1.children.length == 0) {\n                    if (node1.textContent != node2.textContent)\n                        return false;\n                }\n                else\n                    for (var i = 0; i < node1.children.length; i++)\n                        if (!nodeEqual(node1.children[i], node2.children[i]))\n                            return false;\n                return true;\n            }\n            return nodeEqual(doc.body, document.body);\n        }, this.correctOutputHTML).then(result => {\n            if (result)\n                console.log('Accepted');\n            else\n                console.log('Wrong Answer');\n        });\n        this.d.quit().then(() => process.exit());\n    }\n    get homeURL() {\n        return `http://localhost:${this.port}/`;\n    }\n}\nexports.FrontEndTestFramework = FrontEndTestFramework;\n;\nfunction md5(str) {\n    let h = crypto.createHash('md5');\n    h.update(str);\n    return h.digest('hex');\n}\nexports.md5 = md5;\n;\nfunction randStr() {\n    return md5((Date.now() + Math.random()).toString());\n}\nexports.randStr = randStr;\n;\nfunction readScript() {\n    return fs.readFileSync(path.join(__dirname, process.argv[2])).toString();\n}\nexports.readScript = readScript;\n;\nexports.By = webdriver.By;\nexports.until = webdriver.until;\n","import express = require('express');\r\nimport bodyParser = require('body-parser');\r\nimport webdriver = require('selenium-webdriver');\r\nimport crypto = require('crypto');\r\nimport fs = require('fs');\r\nimport path = require('path');\r\n\r\nexport class FrontEndTestFramework {\r\n\tpublic d = new webdriver.Builder()\r\n\t\t.forBrowser('firefox')\r\n\t\t.build();\r\n\tpublic e: express.Express = express();\r\n\t\r\n\tpublic inputHTML: string;\r\n\tpublic correctOutputHTML: string;\r\n\r\n\tprivate port: number;\r\n\t\r\n\tpublic constructor() {\r\n\t\tif (!fs.existsSync(process.argv[2])) {\r\n\t\t\tconsole.log(\"Runtime Error\");\r\n\t\t\tconsole.log(\"You may want to append <path/to/user/script.js> as an argument.\");\r\n\t\t\tprocess.exit();\r\n\t\t}\r\n\t\tthis.e.get(\"/\", (req, res, next) => {\r\n\t\t\tres.type(\"html\").end(this.inputHTML);\r\n\t\t});\r\n\t\tthis.e.use(bodyParser.urlencoded({ extended: false }));\r\n\t}\r\n\r\n\tpublic startServer({ \r\n\t\tstaticRoot = \"./static/\",\r\n\t\tportMaxTrial = 10\r\n\t} = {}) {\r\n\t\t\r\n\t\tlet trialLeft = portMaxTrial;\r\n\t\tlet probe = cb => {\r\n\t\t\tif (--trialLeft == 0)\r\n\t\t\t\tthrow \"Unable to find a free port for server\";\r\n\t\t\tthis.port = Math.round(Math.random() * 8192 + 8192);\r\n\t\t\tthis.e.listen(this.port, 'localhost', () => {\r\n\t\t\t\tthis.d.get(this.homeURL);\r\n\t\t\t\tcb.apply(this);\r\n\t\t\t}).on('error', () => probe(cb));\r\n\t\t}\r\n\t\tthis.e.use(express.static(staticRoot));\r\n\t\treturn new Promise<void>(probe);\r\n\t}\r\n\t\r\n\tpublic waitWithTimeout(cond: webdriver.until.Condition<webdriver.WebElement>) {\r\n\t\treturn this.d.wait(cond, 2000).thenCatch(() => {\r\n\t\t\tconsole.log(\"Time Limit Exceeded\");\r\n\t\t\tprocess.exit();\r\n\t\t});\r\n\t}\r\n\t\r\n\tpublic runUserScript() {\r\n\t\tthis.d.executeScript(readScript()).thenCatch(() => {\r\n\t\t\tconsole.log(\"Runtime Error\");\r\n\t\t\tprocess.exit();\r\n\t\t});\r\n\t}\r\n\t\r\n\tpublic testEqualityAndEnd() {\r\n\t\tthis.d.executeScript<boolean>(function (answer) {\r\n\t\t\t// 在浏览器上执行的判断脚本\r\n\t\t\tvar doc = document.implementation.createHTMLDocument(\"\");\r\n\t\t\tdoc.documentElement.innerHTML = answer;\r\n\t\t\t\r\n\t\t\tfunction nodeEqual(node1, node2) {\r\n\t\t\t\tif (node1.tagName != node2.tagName)\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t\t\r\n\t\t\t\tvar attr1 = node1.attributes, attr2 = node2.attributes;\r\n\t\t\t\tfor (var i = 0; i < attr1.length; i++)\r\n\t\t\t\t\tif (attr1[i].specified) {\r\n\t\t\t\t\t\tvar that = attr2.getNamedItem(attr1[i].name);\r\n\t\t\t\t\t\tif (!that || that.value != attr1[i].value)\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\tfor (var i = 0; i < attr2.length; i++)\r\n\t\t\t\t\tif (attr2[i].specified) {\r\n\t\t\t\t\t\tvar that = attr1.getNamedItem(attr2[i].name);\r\n\t\t\t\t\t\tif (!that || that.value != attr2[i].value)\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\tif (!node1.children || !node2.children ||\r\n\t\t\t\t\tnode1.children.length != node2.children.length)\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t\t\r\n\t\t\t\tif (node1.children.length == 0) {\r\n\t\t\t\t\tif (node1.textContent != node2.textContent)\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t} else\r\n\t\t\t\t\tfor (var i = 0; i < node1.children.length; i++)\r\n\t\t\t\t\t\tif (!nodeEqual(node1.children[i], node2.children[i]))\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\treturn nodeEqual(doc.body, document.body);\r\n\t\t}, this.correctOutputHTML).then(result => {\r\n\t\t\tif (result)\r\n\t\t\t\tconsole.log('Accepted');\r\n\t\t\telse\r\n\t\t\t\tconsole.log('Wrong Answer');\r\n\t\t});\r\n\t\tthis.d.quit().then(() => process.exit());\r\n\t}\r\n\r\n\tpublic get homeURL() {\r\n\t\treturn `http://localhost:${this.port}/`;\r\n\t}\r\n};\r\n\r\nexport function md5(str: string) {\r\n\tlet h = crypto.createHash('md5');\r\n\th.update(str);\r\n\treturn h.digest('hex');\r\n};\r\nexport function randStr() {\r\n\treturn md5((Date.now() + Math.random()).toString());\r\n};\r\nexport function readScript() {\r\n\treturn fs.readFileSync(path.join(__dirname, process.argv[2])).toString();\r\n};\r\nexport var By = webdriver.By;\r\nexport var until = webdriver.until;"],"sourceRoot":"/source/"}